(()=>{const e=JSON.parse('{"decos":{"AffinitySliding":1,"BlastResistance":1,"Bombardier":1,"Botanist":1,"CarvingPro":1,"ChameleosBlessing":1,"DefenseBoost":1,"Defiance":1,"Diversion":1,"DragonAttack":1,"DragonResistance":1,"FireAttack":1,"FireResistance":1,"FlinchFree":1,"FreeMeal":1,"Geologist":1,"HornMaestro":1,"HungerResistance":1,"IceAttack":1,"IceResistance":1,"Inspiration":1,"IntrepidHeart":1,"KushalaBlessing":1,"LeapofFaith":1,"MuckResistance":1,"ParalysisResistance":1,"PoisonAttack":1,"PoisonResistance":1,"RecoilDown":1,"RecoverySpeed":1,"ReloadSpeed":1,"ShockAbsorber":1,"SleepResistance":1,"SpeedSharpening":1,"SpiribirdsCall":1,"StaminaThief":1,"Steadiness":1,"StunResistance":1,"TeostraBlessing":1,"ThunderAttack":1,"ThunderResistance":1,"WallRunnerBoost":1,"WaterAttack":1,"WaterResistance":1,"Windproof":1,"AdrenalineRush":2,"Agitator":2,"Artillery":2,"AttackBoost":2,"Ballistics":2,"BladescaleHone":2,"BlastAttack":2,"BlightResistance":2,"Bludgeoner":2,"BubblyDance":2,"Burst":2,"ChargeMaster":2,"Coalescence":2,"Constitution":2,"Counterstrike":2,"CriticalBoost":2,"CriticalElement":2,"CriticalEye":2,"DivineBlessing":2,"ElementExploit":2,"Embolden":2,"EvadeExtender":2,"EvadeWindow":2,"Focus":2,"Foray":2,"Fortify":2,"Guard":2,"GuardUp":2,"Heroics":2,"ItemProlonger":2,"LatentPower":2,"LoadShells":2,"MarathonRunner":2,"MasterMounter":2,"MastersTouch":2,"MaximumMight":2,"MindsEye":2,"ParalysisAttack":2,"Partbreaker":2,"PeakPerformance":2,"PowerProlonger":2,"ProtectivePolish":2,"PunishingDraw":2,"QuickSheathe":2,"RapidMorph":2,"RazorSharp":2,"RecoveryUp":2,"Resentment":2,"Resuscitate":2,"SleepAttack":2,"Slugger":2,"SneakAttack":2,"SpareShot":2,"SpecialAmmoBoost":2,"SpeedEating":2,"StaminaSurge":2,"TremorResistance":2,"WallRunner":2,"WeaknessExploit":2,"Wide-Range":2,"WirebugWhisperer":2,"AmmoUp":3,"BloodRite":3,"CriticalDraw":3,"Earplugs":3,"GoodLuck":3,"GrinderS":3,"Handicraft":3,"HellfireCloak":3,"JumpMaster":3,"Mushroomancer":3,"NormalRapidUp":3,"OffensiveGuard":3,"PierceUp":3,"QuickBreath":3,"RapidFireUp":3,"Redirection":3,"SpreadUp":3,"StatusTrigger":3,"Tune-Up":3,"Bloodlust":4,"BowChargePlus":4,"Dragonheart":4},"maxLevel":{"AdrenalineRush":3,"AffinitySliding":1,"Agitator":5,"AmmoUp":3,"Artillery":3,"AttackBoost":7,"Ballistics":3,"Berserk":2,"BladescaleHone":3,"BlastAttack":3,"BlastResistance":3,"BlightResistance":3,"BloodAwakening":3,"Bloodlust":3,"BloodRite":3,"Bludgeoner":3,"Bombardier":3,"Botanist":4,"BowChargePlus":1,"BubblyDance":3,"BuildupBoost":3,"Burst":3,"CaptureMaster":1,"CarvingMaster":1,"CarvingPro":1,"ChameleosBlessing":4,"ChargeMaster":3,"Coalescence":3,"Constitution":5,"Counterstrike":3,"CriticalBoost":3,"CriticalDraw":3,"CriticalElement":3,"CriticalEye":7,"DefenseBoost":7,"Defiance":5,"Dereliction":3,"Diversion":1,"DivineBlessing":3,"DragonAttack":5,"DragonConversion":3,"Dragonheart":5,"DragonResistance":3,"Earplugs":5,"ElementExploit":3,"Embolden":3,"EvadeExtender":3,"EvadeWindow":5,"FireAttack":5,"FireResistance":3,"FlinchFree":3,"Focus":3,"Foray":3,"Fortify":1,"FreeMeal":3,"FrenziedBloodlust":3,"Frostcraft":3,"Furious":3,"Geologist":3,"GoodLuck":3,"GrinderS":3,"Guard":5,"GuardUp":3,"Guts":3,"Handicraft":5,"Heaven-Sent":3,"HellfireCloak":4,"Heroics":5,"HornMaestro":1,"HungerResistance":3,"IceAttack":5,"IceResistance":3,"Inspiration":1,"IntrepidHeart":2,"ItemProlonger":3,"JumpMaster":1,"KushalaBlessing":4,"LatentPower":5,"LeapofFaith":1,"LoadShells":2,"MailofHellfire":3,"MarathonRunner":3,"MasterMounter":1,"MastersTouch":3,"MaximumMight":3,"MindsEye":3,"MuckResistance":2,"Mushroomancer":3,"NormalRapidUp":3,"OffensiveGuard":3,"ParalysisAttack":3,"ParalysisResistance":3,"Partbreaker":3,"PeakPerformance":3,"PierceUp":3,"PoisonAttack":3,"PoisonResistance":3,"PowderMantle":3,"PowerProlonger":3,"ProtectivePolish":3,"PunishingDraw":3,"QuickBreath":1,"QuickSheathe":3,"RapidFireUp":3,"RapidMorph":3,"RazorSharp":3,"RecoilDown":3,"RecoverySpeed":3,"RecoveryUp":3,"Redirection":2,"ReloadSpeed":3,"Resentment":5,"Resuscitate":3,"ShockAbsorber":1,"SleepAttack":3,"SleepResistance":3,"Slugger":3,"SneakAttack":3,"SpareShot":3,"SpecialAmmoBoost":2,"SpeedEating":3,"SpeedSharpening":3,"SpiribirdsCall":1,"SpreadUp":3,"StaminaSurge":3,"StaminaThief":3,"StatusTrigger":3,"Steadiness":3,"Stormsoul":5,"Strife":3,"StunResistance":3,"TeostraBlessing":4,"ThunderAlignment":5,"ThunderAttack":5,"ThunderResistance":3,"TremorResistance":3,"Tune-Up":2,"WallRunner":3,"WallRunnerBoost":1,"WaterAttack":5,"WaterResistance":3,"WeaknessExploit":3,"Wide-Range":5,"WindAlignment":5,"WindMantle":3,"Windproof":3,"WirebugWhisperer":3},"qurious":{"AmmoUp":15,"AttackBoost":15,"CriticalBoost":15,"CriticalEye":15,"Guts":15,"MastersTouch":15,"NormalRapidUp":15,"PierceUp":15,"RapidFireUp":15,"RazorSharp":15,"SpareShot":15,"SpreadUp":15,"WeaknessExploit":15,"Agitator":12,"Artillery":12,"BloodRite":12,"Bloodlust":12,"BuildupBoost":12,"Burst":12,"Coalescence":12,"DragonConversion":12,"Frostcraft":12,"GoodLuck":12,"Handicraft":12,"LatentPower":12,"MaximumMight":12,"PeakPerformance":12,"RapidMorph":12,"Resentment":12,"Resuscitate":12,"SneakAttack":12,"Tune-Up":12,"AdrenalineRush":9,"Ballistics":9,"BladescaleHone":9,"ChargeMaster":9,"CriticalDraw":9,"CriticalElement":9,"Dragonheart":9,"Earplugs":9,"ElementExploit":9,"Focus":9,"Foray":9,"FrenziedBloodlust":9,"Furious":9,"GrinderS":9,"HellfireCloak":9,"Heroics":9,"MailofHellfire":9,"MindsEye":9,"Mushroomancer":9,"OffensiveGuard":9,"PowderMantle":9,"PowerProlonger":9,"ProtectivePolish":9,"Redirection":9,"StatusTrigger":9,"Strife":9,"WindMantle":9,"WirebugWhisperer":9,"BlastAttack":6,"BubblyDance":6,"ChameleosBlessing":6,"Constitution":6,"Counterstrike":6,"Defiance":6,"Embolden":6,"EvadeExtender":6,"EvadeWindow":6,"Guard":6,"GuardUp":6,"IntrepidHeart":6,"KushalaBlessing":6,"LoadShells":6,"MarathonRunner":6,"ParalysisAttack":6,"Partbreaker":6,"PoisonAttack":6,"PunishingDraw":6,"QuickSheathe":6,"RecoilDown":6,"ReloadSpeed":6,"SleepAttack":6,"Slugger":6,"SpecialAmmoBoost":6,"SpeedEating":6,"StaminaSurge":6,"Steadiness":6,"TeostraBlessing":6,"TremorResistance":6,"WallRunner":6,"AffinitySliding":3,"BlastResistance":3,"BlightResistance":3,"DefenseBoost":3,"Diversion":3,"DivineBlessing":3,"DragonAttack":3,"FireAttack":3,"FlinchFree":3,"Fortify":3,"FreeMeal":3,"HornMaestro":3,"HungerResistance":3,"IceAttack":3,"ItemProlonger":3,"LeapofFaith":3,"MasterMounter":3,"MuckResistance":3,"ParalysisResistance":3,"PoisonResistance":3,"RecoverySpeed":3,"RecoveryUp":3,"SleepResistance":3,"SpeedSharpening":3,"SpiribirdsCall":3,"StaminaThief":3,"StunResistance":3,"ThunderAttack":3,"WallRunnerBoost":3,"WaterAttack":3,"Wide-Range":3,"Windproof":3},"pointsPerSlot":[{"ChameleosBlessing":1,"Defiance":1,"IntrepidHeart":1,"KushalaBlessing":1,"PoisonAttack":1,"RecoilDown":1,"ReloadSpeed":1,"Steadiness":1,"TeostraBlessing":1,"AffinitySliding":1,"BlastResistance":1,"DefenseBoost":1,"Diversion":1,"DragonAttack":1,"FireAttack":1,"FlinchFree":1,"FreeMeal":1,"HornMaestro":1,"HungerResistance":1,"IceAttack":1,"LeapofFaith":1,"MuckResistance":1,"ParalysisResistance":1,"PoisonResistance":1,"RecoverySpeed":1,"SleepResistance":1,"SpeedSharpening":1,"SpiribirdsCall":1,"StaminaThief":1,"StunResistance":1,"ThunderAttack":1,"WallRunnerBoost":1,"WaterAttack":1,"Windproof":1,"Bombardier":1,"Botanist":1,"CarvingPro":1,"DragonResistance":1,"FireResistance":1,"Geologist":1,"IceResistance":1,"Inspiration":1,"ShockAbsorber":1,"ThunderResistance":1,"WaterResistance":1},{"AttackBoost":1,"CriticalBoost":1,"CriticalEye":1,"MastersTouch":1,"RazorSharp":1,"SpareShot":1,"WeaknessExploit":1,"Agitator":1,"Artillery":1,"Burst":1,"Coalescence":1,"LatentPower":1,"MaximumMight":1,"PeakPerformance":1,"RapidMorph":1,"Resentment":1,"Resuscitate":1,"SneakAttack":1,"AdrenalineRush":1,"Ballistics":1,"BladescaleHone":1,"ChargeMaster":1,"CriticalElement":1,"ElementExploit":1,"Focus":1,"Foray":1,"Heroics":1,"MindsEye":1,"PowerProlonger":1,"ProtectivePolish":1,"WirebugWhisperer":1,"BlastAttack":1,"BubblyDance":1,"Constitution":1,"Counterstrike":1,"Embolden":1,"EvadeExtender":1,"EvadeWindow":1,"Guard":1,"GuardUp":1,"LoadShells":1,"MarathonRunner":1,"ParalysisAttack":1,"Partbreaker":1,"PunishingDraw":1,"QuickSheathe":1,"SleepAttack":1,"Slugger":1,"SpecialAmmoBoost":1,"SpeedEating":1,"StaminaSurge":1,"TremorResistance":1,"WallRunner":1,"ChameleosBlessing":1,"DefenseBoost":2,"Defiance":1,"DragonAttack":2,"FireAttack":2,"IceAttack":2,"IntrepidHeart":1,"KushalaBlessing":1,"PoisonAttack":1,"RecoilDown":1,"ReloadSpeed":1,"Steadiness":1,"TeostraBlessing":1,"ThunderAttack":2,"WaterAttack":2,"BlightResistance":1,"DivineBlessing":1,"Fortify":1,"ItemProlonger":1,"MasterMounter":1,"RecoveryUp":1,"Wide-Range":1,"AffinitySliding":1,"BlastResistance":1,"Diversion":1,"FlinchFree":1,"FreeMeal":1,"HornMaestro":1,"HungerResistance":1,"LeapofFaith":1,"MuckResistance":1,"ParalysisResistance":1,"PoisonResistance":1,"RecoverySpeed":1,"SleepResistance":1,"SpeedSharpening":1,"SpiribirdsCall":1,"StaminaThief":1,"StunResistance":1,"WallRunnerBoost":1,"Windproof":1,"Bludgeoner":1,"Bombardier":1,"Botanist":1,"CarvingPro":1,"DragonResistance":1,"FireResistance":1,"Geologist":1,"IceResistance":1,"Inspiration":1,"ShockAbsorber":1,"ThunderResistance":1,"WaterResistance":1},{"AmmoUp":1,"NormalRapidUp":1,"PierceUp":1,"RapidFireUp":1,"SpreadUp":1,"AttackBoost":1,"CriticalBoost":1,"CriticalEye":1,"MastersTouch":1,"RazorSharp":1,"SpareShot":1,"WeaknessExploit":1,"BloodRite":1,"GoodLuck":1,"Handicraft":1,"Tune-Up":1,"Agitator":1,"Artillery":1,"Burst":1,"Coalescence":1,"Guard":2,"LatentPower":1,"MaximumMight":1,"PeakPerformance":1,"RapidMorph":1,"Resentment":1,"Resuscitate":1,"SneakAttack":1,"IntrepidHeart":2,"CriticalDraw":1,"Earplugs":1,"GrinderS":1,"HellfireCloak":1,"Mushroomancer":1,"OffensiveGuard":1,"Redirection":1,"StatusTrigger":1,"AdrenalineRush":1,"Ballistics":1,"BladescaleHone":1,"ChargeMaster":1,"CriticalElement":1,"ElementExploit":1,"Focus":1,"Foray":1,"Heroics":1,"MindsEye":1,"PowerProlonger":1,"ProtectivePolish":1,"Wide-Range":3,"WirebugWhisperer":1,"DefenseBoost":3,"DragonAttack":3,"FireAttack":3,"IceAttack":3,"ThunderAttack":3,"WaterAttack":3,"BlastAttack":1,"BubblyDance":1,"Constitution":1,"Counterstrike":1,"Embolden":1,"EvadeExtender":1,"EvadeWindow":1,"GuardUp":1,"LoadShells":1,"MarathonRunner":1,"ParalysisAttack":1,"Partbreaker":1,"PunishingDraw":1,"QuickSheathe":1,"SleepAttack":1,"Slugger":1,"SpecialAmmoBoost":1,"SpeedEating":1,"StaminaSurge":1,"TremorResistance":1,"WallRunner":1,"ChameleosBlessing":1,"Defiance":1,"KushalaBlessing":1,"PoisonAttack":1,"RecoilDown":1,"ReloadSpeed":1,"Steadiness":1,"TeostraBlessing":1,"BlightResistance":1,"DivineBlessing":1,"Fortify":1,"ItemProlonger":1,"MasterMounter":1,"RecoveryUp":1,"AffinitySliding":1,"BlastResistance":1,"Diversion":1,"FlinchFree":1,"FreeMeal":1,"HornMaestro":1,"HungerResistance":1,"LeapofFaith":1,"MuckResistance":1,"ParalysisResistance":1,"PoisonResistance":1,"RecoverySpeed":1,"SleepResistance":1,"SpeedSharpening":1,"SpiribirdsCall":1,"StaminaThief":1,"StunResistance":1,"WallRunnerBoost":1,"Windproof":1,"JumpMaster":1,"QuickBreath":1,"Bludgeoner":1,"Bombardier":1,"Botanist":1,"CarvingPro":1,"DragonResistance":1,"FireResistance":1,"Geologist":1,"IceResistance":1,"Inspiration":1,"ShockAbsorber":1,"ThunderResistance":1,"WaterResistance":1},{"AmmoUp":2,"NormalRapidUp":2,"PierceUp":2,"SpreadUp":2,"AttackBoost":2,"CriticalEye":2,"MastersTouch":2,"RazorSharp":2,"SpareShot":2,"BloodRite":2,"GoodLuck":2,"Handicraft":2,"Tune-Up":2,"Agitator":2,"Artillery":2,"Burst":2,"Coalescence":2,"LatentPower":2,"MaximumMight":2,"PeakPerformance":2,"RapidMorph":2,"Resentment":2,"Resuscitate":2,"SneakAttack":2,"CriticalDraw":2,"Earplugs":2,"GrinderS":2,"HellfireCloak":2,"Mushroomancer":2,"OffensiveGuard":2,"Redirection":2,"StatusTrigger":2,"AdrenalineRush":2,"Ballistics":2,"BladescaleHone":2,"ChargeMaster":2,"CriticalElement":2,"ElementExploit":2,"Focus":2,"Foray":2,"Heroics":2,"MindsEye":2,"PowerProlonger":2,"ProtectivePolish":2,"WallRunner":3,"WirebugWhisperer":2,"Defiance":3,"PoisonAttack":3,"Steadiness":3,"RapidFireUp":1,"CriticalBoost":1,"WeaknessExploit":1,"DefenseBoost":5,"Bloodlust":1,"BlastAttack":2,"BubblyDance":2,"Constitution":2,"Counterstrike":2,"Embolden":2,"EvadeExtender":2,"EvadeWindow":2,"Guard":2,"GuardUp":2,"LoadShells":2,"MarathonRunner":2,"ParalysisAttack":2,"Partbreaker":2,"PunishingDraw":2,"QuickSheathe":2,"SleepAttack":2,"Slugger":2,"SpecialAmmoBoost":2,"SpeedEating":2,"StaminaSurge":2,"TremorResistance":2,"Wide-Range":4,"DragonAttack":4,"FireAttack":4,"IceAttack":4,"IntrepidHeart":2,"ThunderAttack":4,"WaterAttack":4,"Dragonheart":1,"ItemProlonger":3,"BlastResistance":3,"FlinchFree":3,"FreeMeal":3,"HungerResistance":3,"ParalysisResistance":3,"PoisonResistance":3,"RecoverySpeed":3,"SleepResistance":3,"SpeedSharpening":3,"StaminaThief":3,"StunResistance":3,"Windproof":3,"BlightResistance":2,"DivineBlessing":2,"RecoveryUp":2,"ChameleosBlessing":1,"KushalaBlessing":1,"RecoilDown":1,"ReloadSpeed":1,"TeostraBlessing":1,"Fortify":1,"MasterMounter":1,"AffinitySliding":1,"Diversion":1,"HornMaestro":1,"LeapofFaith":1,"MuckResistance":1,"SpiribirdsCall":1,"WallRunnerBoost":1,"BowChargePlus":1,"JumpMaster":1,"QuickBreath":1,"Bludgeoner":1,"Bombardier":3,"Botanist":3,"CarvingPro":1,"DragonResistance":3,"FireResistance":3,"Geologist":3,"IceResistance":3,"Inspiration":1,"ShockAbsorber":1,"ThunderResistance":3,"WaterResistance":3}]}');let t=!self.origin.includes("github");const i=new Map,s=new Map,o=["leg","waist","arm","chest","helm"],a=new Map;let n=new Map,r={0:[],3:[],2:[],1:[]};const l=(e,t)=>e>=t?e:t,c=(e,t)=>e<=t?e:t,u=(e,t)=>{for(let i=0;i<4;i++)t.remainingSlots[i]=l(t.remainingSlots[i]||0,e.remainingSlots[i]);for(let i=0;i<5;i++)t.quriousSkills[i]=l(t.quriousSkills[i]||0,e.quriousSkills[i]);for(const[i,s]of Object.entries(e.armorSkills))t.armorSkills[i]=l(t.armorSkills[i]||0,s)};let d={};const g=new Map;function f(e,t){for(const i in e)if(t.get(i)+e[i]>n.get(i).maxLevel)return!0}function p(e,t){let i=0;if(e){for(let i of g.values())i[0]+=-e.decos[i[1]]+t.decos[i[1]];for(let t of e.requestedSkills)a.set(t,a.get(t)-e.skills[t])}else for(let e of g.values())e[0]+=t.decos[e[1]];d[t.type]=t;for(let e of t.requestedSkills)a.set(e,a.get(e)+t.skills[e]),a.get(e)>n.get(e).maxLevel&&++i;return i}self.onmessage=s=>{t&&(t=performance.now());const l={sets:[],count:{sets:0,combos:0},stats:{quriousSkills:[0,0,0,0,0],armorSkills:{},remainingSlots:[0,0,0,0]}};let{decos:c,maxLevel:S,qurious:k,pointsPerSlot:R}=e,{theseCharms:m,skills:B,armors:P}=s.data;for(let[e,t]of B)i.set(e,t),a.set(e,0),n.set(e,{qurious:k[e]/3,maxLevel:S[e]});B=Object.fromEntries(B),R.forEach(((e,t)=>{let i=[];for(let t in e)B[t]&&(i[i.length]=[t,e[t]]);r[t]=i.sort(((e,t)=>k[t[0]]*t[1]-k[e[0]]*e[1]||c[t[0]]-c[e[0]]))}));for(let e=0;e<4;++e)g.set(e,[s.data.charmSlots[e],e]);const A=[],{setLimiter:E,charmNeeded:F,setBonus:b}=s.data.skillInfo;for(const e of P.helm){p(d.helm,e);for(const e of P.chest){p(d.chest,e);for(const e of P.arm)if(!p(d.arm,e))for(const e of P.waist)if(!p(d.waist,e))e:for(const e of P.leg){if(p(d.leg,e))continue;if(b)for(let e in b)if(!(a.get(e)+b[e]<0))continue e;const[...r]=a;let c;o.sort(((e,t)=>d[e].skillLimitation-d[t].skillLimitation));let S=["standard","qurious","deco"];if(F){S=["charmNeeded"];for(const e in F)if(a.get(e)>=F[e])S=["standard","qurious","deco"];else if((a.get(e)||0)+s.data.skillInfo.charmSkillPoints[e]<F[e])continue e}for(const e of S)if(m[e])for(let s of m[e])for(const e of s)for(const s of e){const e=s.find((e=>!f(e,a)));if(!e)continue;const l={decos:[],augments:{},armorSkills:r,charm:[]};for(const t of i.keys())i.set(t,B[t]+a.get(t)+(e[t]||0));let u=[];for(let e of g.values())u[e[1]]=e[0];if(!h(u,l.decos)&&!M(d,l.augments,o,E)&&(!t||C(l,d,B,e,A,g))){if(!c){let e=y(l.augments);c={usedSkills:[],quriousSkills:e,armorSkills:D(l.augments,d),decoArr:g,count:0,remainingSlots:v(u,l.decos,e.slice())}}for(let e of s){const t=Object.entries(e);a.get(t[0][0])+t[0][1]<=n.get(t[0][0]).maxLevel&&a.get(t[1][0])+t[1][1]<=n.get(t[1][0]).maxLevel&&l.charm.push(t)}c.count+=l.charm.length,c.usedSkills.push(l)}}if(!c)continue e;if(l.count.combos+=c.count,++l.count.sets,u(c,l.stats),l.count.sets>=20&&c.totalCount<l.sets[19].totalCount)continue e;20===l.sets.length?l.sets.pop():l.sets.length||(l.sets[0]=c);let k=l.sets.length;for(;k--&&!(c.totalCount<l.sets[k].totalCount););l.sets.splice(k,0,c)}}}t&&A.length&&console.log(structuredClone(A)),console.log(0,(performance.now()-t)/1e3),postMessage({final:l})};const h=(e,t)=>{for(let s of[0,3,2,1])for(const[o,a]of r[s]){if(!e[s])break;if(i.get(o)>=0)continue;const n=c(e[s],~~(i.get(o)/-a));n&&(i.set(o,i.get(o)+n*a),e[s]-=n,t[t.length]=[o,a,"Slot lvl"+(+s+1),n])}if(s.size)for(let e of s.keys())s.delete(e);for(let e of i.keys()){if(!(i.get(e)<0))continue;if(isNaN(n.get(e).qurious))return!0;const t=n.get(e).qurious;s.has(t)||s.set(t,{total:0,skills:new Set}),s.get(t).total-=i.get(e),s.get(t).skills.add(e)}};function S(e,t,i){return 2===e?function(e,t){let i=[[],0],o=!1,a=0,n=e.length;for(;!o;){if(++a>=n){if(i[1])return i;o=!0,a=0}const r=e[a];for(let o=a;o<n;o++){const a=e[o];if(r+a>t)break;if(!(r+a<=i[1]||s.get(a).total<1+(r===a))&&(i=[[r,a],r+a],i[1]===t))return i}}return i}(t,c(10,i)):3===e?function(e,t){let i=[[],0],o=!1,a=0,n=e.length;for(;!o;){if(++a>=n){if(i[1])return i;o=!0,a=0}let r=+e[a];for(let o=a;o<n;o++){let a=+e[o];if(!(s.get(a).total<1+(r===a)))for(let l=o;l<n;l++){let o=e[l];if(r+a+o>t)break;if(!(r+a+o<=i[1]||s.get(o).total<1+(o===r)+(o===a))&&(i=[[r,a,o],r+a+o],i[1]===t))return i}}}return i}(t,i>15?15:i):k(t,i)||[[0],1]}const k=(e,t)=>{for(let i=e.length-1;i>=0;--i)if(e[i]<=t)return[[e[i]],e[i]];return[[],0]},R=(e,t,o)=>{let a=c(5,~~(t/e))-o[0];for(;a>0;){if(s.has(a)&&s.get(a).total-s.get(a).skills.size>=e-1)for(let n of s.get(a).skills)if(-i.get(n)>=e)return o?[[n,2],[m(n,o,t-2*a)]]:[[n,e]];--a}return!1},m=(e,t,o)=>{let a=c(t[t.length-1],o);for(;a>t[0];){let t=s.get(a);if(s.has(a)&&(t.total>2||!t.skills.has(e)))for(let s of t.skills)if(i.get(s)<-2||s!==e)return[s,1];--a}return e},B=(e,t)=>{t?(e.augs.push({"-Skill":t}),e.quriousPoints+=10):(e.augs.push({"-Def":5}),e.quriousPoints+=5),e.unBloatedPoints=~~(e.quriousPoints/3)},P=(e,t,i=!1)=>{let o=0;for(let a=0;e>0&&a<t.length;++a){const n=c(s.get(t[a]).total-(!1===i?0:1),e);o+=n*t[a],e-=n}return o};function A(e,o,a,r=1){let l=n.get(e).qurious*r;if(!o.innateSkills.has(e)){if(5===o.innateSkills.size)return!0;o.innateSkills.add(e)}if(o.unBloatedPoints<l)return t&&console.log(o,o.augs,e),!0;for(o.quriousPoints-=3*l,o.unBloatedPoints-=l,i.set(e,i.get(e)+r),0==(s.get(l).total-=r)?(s.delete(l),a.splice(a.indexOf(l),1)):0===i.get(e)&&s.get(l).skills.delete(e);r--;)o.augs.push({"+Skill":e})}const M=(e,t,o,a)=>{let r=0;for(let e of s.values())r+=e.total;let[...l]=s.keys(),u=5*a-r;if(u<0)return!0;e:for(const o in e){let a=e[o];t[a.name]={augs:[a.augs[0],a.augs[1],a.augs[2]],innateSkills:new Set,skillsRemovedCount:-1,quriousPoints:a.startingQuriousPoints,unBloatedPoints:~~(a.quriousPoints/3),type:a.type};const d=t[a.name];for(let e in a.skills)d.innateSkills.add(e);if(r<=0)continue;let g,f=6-d.augs.length,p=5-d.innateSkills.size,h=c(f,r),k=f-r;for(;--k>=0||P(h,l)>d.unBloatedPoints&&--h>0;){if(--u<0)return!0;let e=a.fodderSkills[++d.skillsRemovedCount];B(d,e)}if(h){if(p<h)for(let e of a.requestedSkills){if(i.get(e)>=0)continue;const t=n.get(e).qurious;for(;p<h&&i.get(e)<0&&t+P(h-1,l,t)<=d.unBloatedPoints;)A(e,d,l)||(--h,--r)}if(p<h)for(;h>p;){let e=R(h,d.unBloatedPoints,1===p?[0]:l[0]);if(e){for(let t of e)for(;t[1]--&&!A(t[0],d,l);)--r;if(1===p)continue e}if(--u<0)return!0;--h,B(d,a.fodderSkills[++d.skillsRemovedCount])}if(d.unBloatedPoints>=l[0]){if(g=S(h,l,d.unBloatedPoints),!g[0])continue;for(const e of g[0])A(s.get(e).skills.values().next().value,d,l)||--r}}}e:for(const i of o){let o=t[e[i].name];if(!r||a<4||!l.length)break;if(!(o.quriousPoints<3*+l[0]))for(let e=o.augs.length-1;e>=0&&o.unBloatedPoints>0;e--){if(6===o.augs.length&&o.quriousPoints<3||o.quriousPoints<8&&!o.augs[e]["-Skill"]||!o.augs[e]["-Def"])continue e;let t,i,a=o.augs,n=a.length<6?0:a[e]["-Def"]?1:a[e]["-Skill"]?2:void 0;if(void 0===n)continue;let c=l.length-1;t:for(;c>=0;c--)if(!((o.quriousPoints-5*n)/3<l[c]))for(let e of s.get(l[c]).skills)if(o.innateSkills.size<5||o.innateSkills.has(e)){t=l[c],i=e;break t}if(!t)continue e;n&&(o.quriousPoints-=5*n,o.unBloatedPoints=~~(o.quriousPoints/3),a.splice(e,1)),A(i,o,l)||--r}}return l.length};function C(e,t,a,n,r,l){let c={...n};e.decos.forEach((([e,t,,i])=>{c[e]=(c[e]||0)+t*i}));for(const t of e.armorSkills)c[t[0]]=(c[t[0]]||0)+t[1];for(const i of o)e.augments[t[i].name].augs.forEach((e=>{e["+Skill"]&&(c[e["+Skill"]]=(c[e["+Skill"]]||0)+1)}));if(Object.entries(a).every((e=>c[e[0]]+e[1]>=0)))return!0;r.push({skillsNeeded:a,innateArmorSkills:e.armorSkills,charmSkills:e.charm,initalDecos:l,decosRecord:e.decos,skillsNeededAfterDecos:i,skillAugmentsRecorded:e.augments,skillsByCostListAfterAugment:s})}function v(e,t,i){for(let s=4;s>=0;s--)if(i[s])for(let[o,a,r,l]of t){if(s!==n.get(o).qurious||i[s]<a)continue;const t=c(l,~~(i[s]/a));e[r[9]-1]+=t,i[s]-=t*a}return e}function y(e){const t=[0,0,0,0,0];for(const i in e){let s=e[i];if(s.quriousPoints<(6===s.augs.length?8:3)||s.innateSkills?.size>4)continue;let o=0,a=0;const n=5-s.innateSkills.size;for(let e of s.augs)e["-Def"]?++o:e["-Skill"]&&++a;let r=6-s.augs.length,l=--r>=0?0:--o>=0?5:--a>=0?10:"continue";if("continue"===l)continue;let u=1;for(;s.quriousPoints>=l+3*u&&u<=n;){let e=c(5,~~((s.quriousPoints-l)/u/3));for(;e--;)++t[e];if(l+=--r>=0?0:--o>=0?5:--a>=0?10:"continue","continue"===l)break;++u}}return t}function D(e,t,i={}){for(const s in e){let o=e[s],a=t[o.type],n=0;for(let e of o.augs)e["-Skill"]&&++n;if(n===a.fodderCount&&o.quriousPoints<5)continue;let r=a.fodderCount-n+c(~~(o.quriousPoints/5),o.fodderCount);for(let e in a.skills)o.innateSkills.has(e)||(i[e]=(i[e]||0)+c(o[e],r))}return i}})();