<<<<<<< HEAD
(self.webpackChunkmhrdamage=self.webpackChunkmhrdamage||[]).push([[517,975],{517:(e,t,o)=>{o.r(t),o.d(t,{konamiCode:()=>f,loadState:()=>d,saveState:()=>c});var s=o(975),l=o(6);const n=e=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)};let i=document.getElementById("dropWeapon").value,r=document.getElementById("dropWeaponType").value,a=()=>{let e="";window.thisKey[r].weapons.forEach(((t,o)=>{t.rank<10||(e+=`<option value="${o}">${t.weapon}</option>`)})),document.getElementById("dropWeapon").innerHTML=e};function c(){const e=[i.selectedIndex,r.selectedIndex];document.querySelectorAll("#skillSelect label").forEach((t=>{e.push([t.textContent,+t.nextElementSibling.textContent.slice(-1)])})),n(JSON.stringify([[e],Object.values(document.querySelectorAll("section.armorDisplay")).map((e=>[].concat(Object.values(e.querySelectorAll(".armor,select.augmentType,select.augment")).map((e=>e.selectedIndex)),Object.values(e.querySelectorAll("select.armorDisplay")).map((e=>e.selectedIndex)))))]))}function d(){navigator.clipboard.readText().then((async e=>{const t=JSON.parse(e),o=await t.shift()[0];document.getElementById("dropWeaponType").selectedIndex=await o.shift(),await(0,l.rA)(),await a(),document.getElementById("dropWeapon").selectedIndex=await o.shift(),await(0,l.E_)(),await o.forEach((e=>(0,l.Nb)(e[0],e[1]))),(0,s.getSetBuilds)(15)}))}document.getElementById("saveState").addEventListener("click",(()=>c())),document.getElementById("loadState").addEventListener("click",(()=>d()));let u=[38,38,40,40,37,39,37,39,97,98,13],m=0;function f(e){(0,l.rA)(e);const t=window.thisKey.types.maxLevel,o=Object.entries(t).sort();document.querySelector("#EquippedSkillDisplay>output").innerHTML=function(e,t){let o="";for(const[s,l]of e){let e="Active",n=["Active","Inactive"];if("Dereliction"===s)n=["Lvl-3","Inactive","Lvl-1","Lvl-2"],e=n[0];else if("Fortify"===s)n=["Inactive","Lvl-1","Lvl-2"],e=n[0];else if("Frostcraft"===s){switch(l){case 1:n=["Lvl-1","Inactive"];break;case 2:n=["Lvl-2","Lvl-1","Inactive"];break;default:n=["Lvl-3","Lvl-2","Lvl-1","Inactive"]}e=n[0]}else"Strife"===s&&(n=["High","Low","Inactive"],e=n[0]);o+=`<button type="button" aria-pressed="false" data-state="0" onclick='let states = ${JSON.stringify(n)}; let index = (parseInt(this.dataset.state) + 1) % states.length; this.textContent = states[index]; this.dataset.state = index;'>${e}</button><output>${t(s)}: ${l}</output>`}return o}(o,(e=>e.replace(/(?<=[a-z])([A-Z])(?![A-Z])/g," $1"))),Object.values(document.querySelectorAll(`select.${e},#dango select`)).forEach((e=>e.selectedIndex=e.childElementCount-1)),Object.values(document.querySelectorAll("#boxes .check")).forEach((e=>e.checked=!0)),console.log("Konami Code entered!")}document.addEventListener("keydown",(function(e){e.keyCode===u[m]?(m++,m===u.length&&(f(document.getElementById("dropWeaponType").value),m=0)):m=0}))},975:(e,t,o)=>{o.r(t),o.d(t,{getArmorTypes:()=>d,getSetBuilds:()=>b,getSkillReq:()=>v,testBuild:()=>x});var s=o(16),l=o(6),n=o(923);const i=(e=window.thisKey.types)=>{const t={},o={};return document.querySelectorAll("#searcherSkills>div>output").forEach((s=>{const l=s.className.split(" ")[1];t[l]=-s.textContent.match(/(?<=Lv-)\d/)[0],o[l]={lvl:e.decos[l]??5,lvl4:e.lvl4[l]??0,qurious:~~((e.qurious[l]??(window.thisKey.charms[l]||e.decos[l]?30:60))/3)},5===o[l].lvl&&o[l].qurious>5&&(window.thisKey.charms[l]?(o.charmNeeded||(o.charmNeeded={}),o.charmNeeded[l]=-t[l],o.charmSkillPoints=window.thisKey.charms[l][0][0]):(o.setBonus||(o.setBonus={}),o.setBonus[l]=-t[l]))})),{skills:Object.fromEntries(Object.entries(t).sort(((e,t)=>o[t[0]].lvl-o[e[0]].lvl||o[e[0]].qurious-o[t[0]].qurious))),skillInfo:o}};let r={};const a=document.getElementById("dropWeapon"),c=document.getElementById("dropWeaponType"),d=["helm","chest","arm","waist","leg"];let u=0,m=0,f=[];var h=0;let p=0,g=new Map,y=!window.location.origin.includes("github"),k=0;const S=e=>{const t=[];for(let o of e)for(let e of o.charm)t.push(`${e[0][0]}: ${e[0][1]} & ${e[1][0]}: ${e[1][1]}`);return t},v=(e=[])=>(document.querySelectorAll(".buildSkills>div>.skill").forEach((t=>{t.selectedIndex>0&&e.push([t.id,t.selectedIndex])})),e),E=(e,t)=>e>=t?e:t;function w(){for(let e=0;e<5;e++)f[e]=new Worker("./setBuildWorker.js",{name:e});f.forEach((e=>{e.addEventListener("message",(e=>{--p,e.data.final.sets.length&&(u+=e.data.final.count.combos,k+=e.data.final.count.sets,g.size<100&&(e=>{for(const t of e){if(g.size<100){g.set(g.size,t);const e=S(t.usedSkills);let o='<button type="button" aria-pressed="false" class="equipBuild">Equip Build</button>';const s=Object.values(t.usedSkills[0].augments);for(let e=0;e<5;e++)o+=`<output class="armorImg ${d[e]}"></output><span>${s[e].name}</span>`;let l="";e.forEach((e=>{l+=`<option value="${e}">${e}</option>`})),o+=`<output class="armorImg charm"></output><select class="armorCharm" title="charmSkill1">${l}</select>`;const n=document.createElement("div");n.classList.add("setResult"),n.innerHTML+=o,o="",document.querySelector(".grid").appendChild(n)}let e=0;for(let t of g.values())t.count&&(e+=t.count);document.getElementById("setOutput").textContent=`Displayed ${Math.min(100,g.size)} Builds / ${e.toLocaleString()} Combinations`}})(e.data.final.sets));let t=e.data.final.stats;for(let e=0;e<4;e++)r.remainingSlots[e]=E(r.remainingSlots[e]||0,t.remainingSlots[e]);for(let e=0;e<5;e++)r.quriousSkills[e]=E(r.quriousSkills[e]||0,t.quriousSkills[e]);for(const[e,o]of Object.entries(t.armorSkills))r.armorSkills[e]=E(r.armorSkills[e]||0,o);p||((e=>{let t="";e.forEach((e=>{0!=e[1]&&(t+=`<button textContent="${e[0]}">${e[0].replace(/(?<=[a-z])([A-Z])(?![A-Z])/g," $1")} +${+e[1]}</button>`)})),document.getElementById("temp")&&document.getElementById("temp").remove(),document.querySelector(".extraSkills").innerHTML+=t,document.getElementById("extraOutput").textContent=`Found ${k.toLocaleString()} Builds / ${u.toLocaleString()} Combinations`,window.location.href.includes("github")||(console.log((performance.now()-m)/1e3),console.log(g))})(((e=window.thisKey.types)=>{const{skills:t}=i(),{armorSkills:o,remainingSlots:s,quriousSkills:l}=r;for(let t=0;t<4;++t)if(s[t])for(const[l,n]of Object.entries(e.decoLevels[t]))o[l]=Math.max(o[l]||0,n*s[t]);Object.entries(e.qurious).forEach((([e,t])=>{l[t/3-1]&&(o[e]=Math.max(o[e]||0,l[t/3-1]))}));const n=[];return Object.entries(o).forEach((([o,s])=>{if(isNaN(o))if(t[o]+ +s>0&&e.maxLevel[o]>0){const l=(e.maxLevel[o]||window.thisKey.skills[o].length-1)+t[o];n.push([o,Math.min(+s,l)])}else t[o]||!e.maxLevel[o]&&!window.thisKey.skills[o]||n.push([o,Math.min(+s,e.maxLevel[o]||window.thisKey.skills[o].length-1)])})),n.sort()})()),u||(document.getElementById("setOutput").textContent="No Results Found",document.querySelectorAll(".grid>div").forEach((e=>e.remove()))))}))}))}const b=(e=10)=>{if((p||y)&&(m=performance.now(),f.length))for(let e of f)e.terminate();p=5,w();const t=i();t.charmSlots=window.thisKey[c.value].weapons[a.value].decos.slice(),document.querySelectorAll(".charmSlot").forEach((e=>{e.selectedIndex>0&&++t.charmSlots[e.selectedIndex-1]})),t.theseCharms={charms:{},charmSkills:{},skill1Names:[],skill2Names:[]};for(let e of Object.entries(t.skills))if(window.thisKey.charms[e[0]]){t.theseCharms.charmSkills[e[0]]=window.thisKey.charms[e[0]];for(let o=0;o<2;++o)(window.thisKey.charms[e[0]][o][0]<=-e[1]&&(!window.thisKey.types.qurious[e[0]]||!window.thisKey.types.decos[e[0]])||-e[1]>2-o&&window.thisKey.types.qurious[e[0]]>3)&&t.theseCharms[`skill${o+1}Names`].push(e[0])}t.armors=function(e,t,o){let s=JSON.parse(JSON.stringify(window.thisKey.armor));const l={helm:[],waist:[],chest:[],arm:[],leg:[]},i=[2.5,4.25,4.25,7];for(let e=0;e<5;++e)(0,n.VW)().forEach((e=>{s[e]=s[e].filter((e=>"MaleOnly"!==e.sex))}));return(0,n.VW)().forEach((n=>{s[n].forEach((s=>{if(!s)return;const r={},a=s.skills;if(13!==s.quriousTable){let e,t=-1;for(let[o,l]of Object.entries(s.decoAugments))++t,0==o||3===o&&t<2||(e=[+o,l[1]]);if(e){const[t,o]=e;r.decos=o,r.decoAugs=Object.keys(s.decoAugments),r.augs=[{"+Slots":-6*+t}],r.quriousPoints=s.quriousPoints-6*t}}else r.decos=[1,1,0,1],r.quriousPoints=0,r.augs=[{def:5},{def:5},{def:5},{def:5},{"+Slots":-18},{"+Slots":-12}];if(r.augs||(r.decos=s.decos,r.augs=[],r.quriousPoints=s.quriousPoints),e.StormSoul>3){const e=4===document.getElementById("StormSoul").selectedIndex?1:2;for(const o of a)t[o].qurious<6&&(a[o]+=e)}r.fodderSkills=[],r.fodderCount=0;let c=r.decos[0]*i[0]+r.decos[1]*i[1]+r.decos[2]*i[2]+r.decos[3]*i[3];for(const[o,l]of Object.entries(a))if(e[o])e[o]?((t.setBonus&&t?.setBonus[o]||t.charmNeeded&&t.charmNeeded[o])&&(c+=15*Math.min(-1*e[o],a[o])),c+=Math.min(-e[o],a[o])*(20===t[o].qurious?4:t[o].qurious/3)):13===s.quriousTable||r.fodderCount||(r.fodderCount=0);else{r.fodderCount+=l;for(let e=0;e<l;e++)r.fodderSkills.push(o)}if(13===s.quriousTable)r.unBloatedPoints=0,r.armorRating=c;else{let e=[],t=3;for(;t--;)r.augs[t]?e=e.concat(r.augs[0]):r.fodderCount-t>0?(e.push({"-Skill":r.fodderSkills.pop()}),r.quriousPoints+=10):(e.push({"-Def":5}),r.quriousPoints+=5);r.augs=e,r.unBloatedPoints=~~(r.quriousPoints/3),r.armorRating=c,r.armorRating=c+r.unBloatedPoints}let d=l[n].length;if(!(d===o&&l[n][--d].armorRating>=r.armorRating)){for(;d>0&&l[n][d-1].armorRating<r.armorRating;)l[n][d]=l[n][--d];l[n][d]=r,r.name=s.name,r.type=n,r.skills=s.skills}}))})),Object.values(l).forEach((t=>{t.forEach((t=>{t.skillLimitation=3-(5-Object.keys(t.skills).length),t.initAugs=t.augs,t.skillKeys=Object.keys(t.skills),t.requestedSkills=Object.keys(t.skills).filter((t=>e[t])),t.skillsRemovedCount=t.fodderCount<3?t.fodderCount:3,t.startingQuriousPoints=t.quriousPoints,delete t.armorRating}))})),l}(t.skills,t.skillInfo,e),t.skillInfo={charmNeeded:t.skillInfo.charmNeeded,charmSkillPoints:t.skillInfo.charmSkillPoints,setBonus:t.skillInfo.setBonus,setLimiter:4-document.getElementById("skillsLimit").selectedIndex},t.skills=Object.entries(t.skills).sort(((e,t)=>window.thisKey.types.qurious[e[0]]-window.thisKey.types.qurious[t[0]]));let o=t.armors.waist.splice(0),s=~~(o.length/5);g.clear();for(const e of f)t.armors.waist=o.splice(0,s),e.postMessage(t);document.getElementById("setReturn").classList.remove("augInvis"),document.querySelectorAll(".extraSkills>button").forEach((e=>e.remove())),document.getElementById("temp")&&document.getElementById("temp").remove(),document.querySelector(".extraSkills").innerHTML+="<P2 id='temp' style='font-size:18px !important; height:15em !important;'>Searching...</P2>",document.getElementsByClassName("grid")[0].innerHTML="",r={remainingSlots:[0,0,0,0],armorSkills:{},quriousSkills:[0,0,0,0,0]},u=0,k=0};let I=0,q="";document.addEventListener("keypress",(e=>{e.key===["t","e","s","t"][Math.min(3,I)]&&++I<3||("Enter"===e.key&&I>=3?(x("f"!==q),q="",I=0):/t|f/.test(e.key)&&I>=3?q=e.key:I<3&&(I=0))})),document.addEventListener("keypress",(e=>{e.key===["b","u","i","l","d"][Math.min(5,h)]&&++h<5||("Enter"===e.key&&h>=5?(B(),h=0):h<5&&(h=0))}));const B=()=>{[["AttackBoost",7],["Bloodlust",3],["BloodRite",3],["Burst",3],["Strife",3],["ChargeMaster",3],["Coalescence",1],["CriticalBoost",3],["CriticalElement",3],["Dragonheart",5],["DragonAttack",5],["ElementExploit",3],["Frostcraft",3],["Resentment",5],["MailofHellfire",3],["Agitator",5],["DragonConversion",3],["WeaknessExploit",3]].forEach((e=>(0,l.Nb)(e[0],e[1]))),b(15),console.log(g)},x=(e=!0)=>([["PeakPerformance",3],["Coalescence",3],["CriticalEye",7],["CriticalBoost",3],["MaximumMight",3],["RecoilDown",3],["ReloadSpeed",3],["RapidFireUp",3],["PierceUp",3],["Burst",1],["Agitator",5],["AttackBoost",7],["AmmoUp",2],["SpareShot",3],["WeaknessExploit",3],["Tune-Up",1],["Bloodlust",1]].forEach((e=>(0,l.Nb)(e[0],e[1]))),b(15),g);document.getElementById("startSearch").addEventListener("click",(()=>b(10))),document.getElementById("normalSearch").addEventListener("click",(()=>b())),document.getElementById("extendedSearch").addEventListener("click",(()=>b(15))),document.querySelector(".grid").addEventListener("mousedown",(e=>{if("BUTTON"!==e.target.tagName)return;const t=Object.values(document.querySelectorAll("div.grid > div.setResult")).indexOf(e.target.parentElement);if(!g.has(t))return;const o=g.get(t);let n=e.target.parentElement.lastElementChild.selectedIndex,i=0;for(let e of o.usedSkills){if(n<e.charm.length)break;++i,n-=e.charm.length}let r=o.usedSkills[i],a=r.charm[n];if((0,s.dj)(a),0!==n){let e=Object.fromEntries(r.charm[0]);for(let t=0;t<2;++t)if(e[a[t][0]]){let o=Math.min(e[a[t][0]],a[t][1]);e[a[t][0]]-=o,a[t][1]-=o}let t=[[],[],[],[]],o=-1;for(let s in e){let l=e[s];if(!l)continue;++o;let n=window.thisKey.charms[s][o][1];for(let e=3;e>=0;--e){let o=window.thisKey.types.pointsPerSlot[e][s],i=n[e]-(n[e+1]||0);for(;--i>=0;)l-o<0||(l-=o,t[e].push(s))}}let s=Object.fromEntries(a);for(let o of r.decos)if(s[o[0]]&&s[o[0]]>=o[1]){s[o[0]]-=o[1];let[l,n,i,c]=o,d=[];for(;i;){t[--i]&&(d=t[i].shift());break}let u=Math.min(c,~~(e[d]/n));for(;u--;)e[d]<=n?o[0]=d:(o[3]-=u,r.decos.push([d,n,i,u])),e[d]-=n,a[0][0]===l?a[0][1]-=n:a[1][1]-=n}o=-1;for(let[t,s]of a){if(++o,!s)continue;let l=[];for(let e of Object.values(r.augments))l.push(...e.augs);for(;s-- >0;){let s=l.find((e=>e["+Skill"]===t));if(s){for(let t in e)if(e[t]>0){s["+Skill"]=t,--e[t],--a[o][1];break}}else console.log("error finding augment to replace")}}}(0,s.qy)(r.augments),(0,s.Cj)((0,s.G_)(r.decos)),document.getElementById("setReturn").classList.add("augInvis"),(0,l.TG)(),document.querySelectorAll(".extraSkills>button").forEach((e=>e.remove())),document.querySelectorAll(".grid>div").forEach((e=>e.remove())),(0,s.to)(),(0,l.TG)(),y&&console.log(JSON.parse(JSON.stringify(r))),g.clear()}))}}]);
=======
(self.webpackChunkmhrdamage=self.webpackChunkmhrdamage||[]).push([[517,975],{517:(e,t,o)=>{o.r(t),o.d(t,{konamiCode:()=>f,loadState:()=>d,saveState:()=>c});var s=o(975),l=o(6);const n=e=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)};let i=document.getElementById("dropWeapon").value,r=document.getElementById("dropWeaponType").value,a=()=>{let e="";window.thisKey[r].weapons.forEach(((t,o)=>{t.rank<10||(e+=`<option value="${o}">${t.weapon}</option>`)})),document.getElementById("dropWeapon").innerHTML=e};function c(){const e=[i.selectedIndex,r.selectedIndex];document.querySelectorAll("#skillSelect label").forEach((t=>{e.push([t.textContent,+t.nextElementSibling.textContent.slice(-1)])})),n(JSON.stringify([[e],Object.values(document.querySelectorAll("section.armorDisplay")).map((e=>[].concat(Object.values(e.querySelectorAll(".armor,select.augmentType,select.augment")).map((e=>e.selectedIndex)),Object.values(e.querySelectorAll("select.armorDisplay")).map((e=>e.selectedIndex)))))]))}function d(){navigator.clipboard.readText().then((async e=>{const t=JSON.parse(e),o=await t.shift()[0];document.getElementById("dropWeaponType").selectedIndex=await o.shift(),await(0,l.rA)(),await a(),document.getElementById("dropWeapon").selectedIndex=await o.shift(),await(0,l.E_)(),await o.forEach((e=>(0,l.Nb)(e[0],e[1]))),(0,s.getSetBuilds)(15)}))}document.getElementById("saveState").addEventListener("click",(()=>c())),document.getElementById("loadState").addEventListener("click",(()=>d()));let u=[38,38,40,40,37,39,37,39,97,98,13],m=0;function f(e){(0,l.rA)(e);const t=window.thisKey.types.maxLevel,o=Object.entries(t).sort();document.querySelector("#EquippedSkillDisplay>output").innerHTML=function(e,t){let o="";for(const[s,l]of e){let e="Active",n=["Active","Inactive"];if("Dereliction"===s)n=["Lvl-3","Inactive","Lvl-1","Lvl-2"],e=n[0];else if("Fortify"===s)n=["Inactive","Lvl-1","Lvl-2"],e=n[0];else if("Frostcraft"===s){switch(l){case 1:n=["Lvl-1","Inactive"];break;case 2:n=["Lvl-2","Lvl-1","Inactive"];break;default:n=["Lvl-3","Lvl-2","Lvl-1","Inactive"]}e=n[0]}else"Strife"===s&&(n=["High","Low","Inactive"],e=n[0]);o+=`<button type="button" aria-pressed="false" data-state="0" onclick='let states = ${JSON.stringify(n)}; let index = (parseInt(this.dataset.state) + 1) % states.length; this.textContent = states[index]; this.dataset.state = index;'>${e}</button><output>${t(s)}: ${l}</output>`}return o}(o,(e=>e.replace(/(?<=[a-z])([A-Z])(?![A-Z])/g," $1"))),Object.values(document.querySelectorAll(`select.${e},#dango select`)).forEach((e=>e.selectedIndex=e.childElementCount-1)),Object.values(document.querySelectorAll("#boxes .check")).forEach((e=>e.checked=!0)),console.log("Konami Code entered!")}document.addEventListener("keydown",(function(e){e.keyCode===u[m]?(m++,m===u.length&&(f(document.getElementById("dropWeaponType").value),m=0)):m=0}))},975:(e,t,o)=>{o.r(t),o.d(t,{getSetBuilds:()=>w,getSkillReq:()=>S,testBuild:()=>B});var s=o(16),l=o(6),n=o(923);const i=(e=window.thisKey.types)=>{const t={},o={};return document.querySelectorAll("#searcherSkills>div>output").forEach((s=>{const l=s.className.split(" ")[1];t[l]=-s.textContent.match(/(?<=Lv-)\d/)[0],o[l]={lvl:e.decos[l]??5,lvl4:e.lvl4[l]??0,qurious:~~((e.qurious[l]??(window.thisKey.charms[l]||e.decos[l]?30:60))/3)},5===o[l].lvl&&o[l].qurious>5&&(window.thisKey.charms[l]?(o.charmNeeded||(o.charmNeeded={}),o.charmNeeded[l]=-t[l],o.charmSkillPoints=window.thisKey.charms[l][0][0]):(o.setBonus||(o.setBonus={}),o.setBonus[l]=-t[l]))})),{skills:Object.fromEntries(Object.entries(t).sort(((e,t)=>o[t[0]].lvl-o[e[0]].lvl||o[e[0]].qurious-o[t[0]].qurious))),skillInfo:o}};let r={};const a=document.getElementById("dropWeapon"),c=document.getElementById("dropWeaponType");let d=0,u=0,m=[];var f=0;let h=0,p=new Map,g=!window.location.origin.includes("github"),y=0;const k=e=>{const t=[];for(let o of e)for(let e of o.charm)t.push(`${e[0][0]}: ${e[0][1]} & ${e[1][0]}: ${e[1][1]}`);return t},S=(e=[])=>(document.querySelectorAll(".buildSkills>div>.skill").forEach((t=>{t.selectedIndex>0&&e.push([t.id,t.selectedIndex])})),e),v=(e,t)=>e>=t?e:t;function E(){for(let e=0;e<5;e++)m[e]=new Worker("./setBuildWorker.js",{name:e});m.forEach((e=>{e.addEventListener("message",(e=>{--h,e.data.final.sets.length&&(d+=e.data.final.count.combos,y+=e.data.final.count.sets,p.size<100&&(e=>{for(const t of e){if(p.size<100){p.set(p.size,t);const e=k(t.usedSkills);let o='<button type="button" aria-pressed="false" class="equipBuild">Equip Build</button>';const s=Object.keys(t.usedSkills[0].augments);for(let e=0;e<5;e++)o+=`<output class="armorImg ${(0,n.VW)()[e]}"></output><span>${s[e]}</span>`;let l="";e.forEach((e=>{l+=`<option value="${e}">${e}</option>`})),o+=`<output class="armorImg charm"></output><select class="armorCharm" title="charmSkill1">${l}</select>`;const i=document.createElement("div");i.classList.add("setResult"),i.innerHTML+=o,o="",document.querySelector(".grid").appendChild(i)}let e=0;for(let t of p.values())t.count&&(e+=t.count);document.getElementById("setOutput").textContent=`Displayed ${Math.min(100,p.size)} Builds / ${e.toLocaleString()} Combinations`}})(e.data.final.sets));let t=e.data.final.stats;for(let e=0;e<4;e++)r.remainingSlots[e]=v(r.remainingSlots[e]||0,t.remainingSlots[e]);for(let e=0;e<5;e++)r.quriousSkills[e]=v(r.quriousSkills[e]||0,t.quriousSkills[e]);for(const[e,o]of Object.entries(t.armorSkills))r.armorSkills[e]=v(r.armorSkills[e]||0,o);h||((e=>{let t="";e.forEach((e=>{0!=e[1]&&(t+=`<button textContent="${e[0]}">${e[0].replace(/(?<=[a-z])([A-Z])(?![A-Z])/g," $1")} +${+e[1]}</button>`)})),document.getElementById("temp")&&document.getElementById("temp").remove(),document.querySelector(".extraSkills").innerHTML+=t,document.getElementById("extraOutput").textContent=`Found ${y.toLocaleString()} Builds / ${d.toLocaleString()} Combinations`,window.location.href.includes("github")||(console.log((performance.now()-u)/1e3),console.log(p))})(((e=window.thisKey.types)=>{const{skills:t}=i(),{armorSkills:o,remainingSlots:s,quriousSkills:l}=r;for(let t=0;t<4;++t)if(s[t])for(const[l,n]of Object.entries(e.decoLevels[t]))o[l]=Math.max(o[l]||0,n*s[t]);Object.entries(e.qurious).forEach((([e,t])=>{l[t/3-1]&&(o[e]=Math.max(o[e]||0,l[t/3-1]))}));const n=[];return Object.entries(o).forEach((([o,s])=>{if(isNaN(o))if(t[o]+ +s>0&&e.maxLevel[o]>0){const l=(e.maxLevel[o]||window.thisKey.skills[o].length-1)+t[o];n.push([o,Math.min(+s,l)])}else t[o]||!e.maxLevel[o]&&!window.thisKey.skills[o]||n.push([o,Math.min(+s,e.maxLevel[o]||window.thisKey.skills[o].length-1)])})),n.sort()})()),d||(document.getElementById("setOutput").textContent="No Results Found",document.querySelectorAll(".grid>div").forEach((e=>e.remove()))))}))}))}const w=(e=10)=>{if((h||g)&&(u=performance.now(),m.length))for(let e of m)e.terminate();h=5,E();const t=i();t.charmSlots=window.thisKey[c.value].weapons[a.value].decos.slice(),document.querySelectorAll(".charmSlot").forEach((e=>{e.selectedIndex>0&&++t.charmSlots[e.selectedIndex-1]})),t.theseCharms={charms:{},charmSkills:{},skill1Names:[],skill2Names:[]};for(let e of Object.entries(t.skills))if(window.thisKey.charms[e[0]]){t.theseCharms.charmSkills[e[0]]=window.thisKey.charms[e[0]];for(let o=0;o<2;++o)(window.thisKey.charms[e[0]][o][0]<=-e[1]&&(!window.thisKey.types.qurious[e[0]]||!window.thisKey.types.decos[e[0]])||-e[1]>2-o&&window.thisKey.types.qurious[e[0]]>3)&&t.theseCharms[`skill${o+1}Names`].push(e[0])}t.armors=function(e,t,o){let s=JSON.parse(JSON.stringify(window.thisKey.armor));const l={helm:[],waist:[],chest:[],arm:[],leg:[]},i=[2.5,4.25,4.25,7];for(let e=0;e<5;++e)(0,n.VW)().forEach((e=>{s[e]=s[e].filter((e=>"MaleOnly"!==e.sex))}));return(0,n.VW)().forEach((n=>{s[n].forEach((s=>{if(!s)return;const r={},a=s.skills;if(13!==s.quriousTable){let e,t=-1;for(let[o,l]of Object.entries(s.decoAugments))++t,0==o||3===o&&t<2||(e=[+o,l[1]]);if(e){const[t,o]=e;r.decos=o,r.decoAugs=Object.keys(s.decoAugments),r.augs=[{"+Slots":-6*+t}],r.quriousPoints=s.quriousPoints-6*t}}else r.decos=[1,1,0,1],r.quriousPoints=0,r.augs=[{def:5},{def:5},{def:5},{def:5},{"+Slots":-18},{"+Slots":-12}];if(r.augs||(r.decos=s.decos,r.augs=[],r.quriousPoints=s.quriousPoints),e.StormSoul>3){const e=4===document.getElementById("StormSoul").selectedIndex?1:2;for(const o of a)t[o].qurious<6&&(a[o]+=e)}r.fodderSkills=[],r.fodderCount=0;let c=r.decos[0]*i[0]+r.decos[1]*i[1]+r.decos[2]*i[2]+r.decos[3]*i[3];for(const[o,l]of Object.entries(a))if(e[o])e[o]?((t.setBonus&&t?.setBonus[o]||t.charmNeeded&&t.charmNeeded[o])&&(c+=15*Math.min(-1*e[o],a[o])),c+=Math.min(-e[o],a[o])*(20===t[o].qurious?4:t[o].qurious/3)):13===s.quriousTable||r.fodderCount||(r.fodderCount=0);else{r.fodderCount+=l;for(let e=0;e<l;e++)r.fodderSkills.push(o)}if(13===s.quriousTable)r.unBloatedPoints=0,r.armorRating=c;else{let e=[],t=3;for(;t--;)r.augs[t]?e=e.concat(r.augs[0]):r.fodderCount-t>0?(e.push({"-Skill":r.fodderSkills.pop()}),r.quriousPoints+=10):(e.push({"-Def":5}),r.quriousPoints+=5);r.augs=e,r.unBloatedPoints=~~(r.quriousPoints/3),r.armorRating=c,r.armorRating=c+r.unBloatedPoints}let d=l[n].length;if(!(d===o&&l[n][--d].armorRating>=r.armorRating)){for(;d>0&&l[n][d-1].armorRating<r.armorRating;)l[n][d]=l[n][--d];l[n][d]=r,r.name=s.name,r.type=n,r.skills=s.skills}}))})),Object.values(l).forEach((t=>{t.forEach((t=>{t.skillLimitation=3-(5-Object.keys(t.skills).length),t.averageCostPerSkill=t.quriousPoints/3,t.needsRequestedSkill=t.skillLimitation>0,t.initAugs=t.augs,t.requestedSkills=Object.keys(t.skills).filter((t=>e[t])),t.skillsRemovedCount=t.fodderCount<3?t.fodderCount:3,t.startingQuriousPoints=t.quriousPoints,delete t.armorRating}))})),l}(t.skills,t.skillInfo,e),t.skillInfo={charmNeeded:t.skillInfo.charmNeeded,charmSkillPoints:t.skillInfo.charmSkillPoints,setBonus:t.skillInfo.setBonus,setLimiter:4-document.getElementById("skillsLimit").selectedIndex},t.skills=Object.entries(t.skills).sort(((e,t)=>window.thisKey.types.qurious[e[0]]-window.thisKey.types.qurious[t[0]]));let o=t.armors.waist.splice(0),s=~~(o.length/5);p.clear();for(const e of m)t.armors.waist=o.splice(0,s),e.postMessage(t);document.getElementById("setReturn").classList.remove("augInvis"),document.querySelectorAll(".extraSkills>button").forEach((e=>e.remove())),document.getElementById("temp")&&document.getElementById("temp").remove(),document.querySelector(".extraSkills").innerHTML+="<P2 id='temp' style='font-size:18px !important; height:15em !important;'>Searching...</P2>",document.getElementsByClassName("grid")[0].innerHTML="",r={remainingSlots:[0,0,0,0],armorSkills:{},quriousSkills:[0,0,0,0,0]},d=0,y=0};let b=0,q="";document.addEventListener("keypress",(e=>{e.key===["t","e","s","t"][Math.min(3,b)]&&++b<3||("Enter"===e.key&&b>=3?(B("f"!==q),q="",b=0):/t|f/.test(e.key)&&b>=3?q=e.key:b<3&&(b=0))})),document.addEventListener("keypress",(e=>{e.key===["b","u","i","l","d"][Math.min(5,f)]&&++f<5||("Enter"===e.key&&f>=5?(I(),f=0):f<5&&(f=0))}));const I=()=>{[["AdrenalineRush",3],["Bloodlust",3],["BloodRite",3],["Burst",3],["ChargeMaster",3],["Coalescence",1],["CriticalBoost",3],["CriticalElement",3],["Defiance",3],["DragonAttack",5],["ElementExploit",3],["Focus",2],["Frostcraft",3],["IntrepidHeart",2],["MailofHellfire",3],["MindsEye",3],["Partbreaker",3],["ProtectivePolish",3],["Slugger",1],["StunResistance",3],["WeaknessExploit",3],["WindMantle",1],["WirebugWhisperer",3]].forEach((e=>(0,l.Nb)(e[0],e[1]))),w(15),console.log(p)},B=(e=!0)=>([["PeakPerformance",3],["Coalescence",3],["CriticalEye",7],["CriticalBoost",3],["MaximumMight",3],["RecoilDown",3],["ReloadSpeed",3],["RapidFireUp",3],["PierceUp",3],["Burst",1],["Agitator",5],["AttackBoost",7],["AmmoUp",2],["SpareShot",3],["WeaknessExploit",3],["Tune-Up",1],["Bloodlust",1]].forEach((e=>(0,l.Nb)(e[0],e[1]))),w(15),p);document.getElementById("startSearch").addEventListener("click",(()=>w(10))),document.getElementById("normalSearch").addEventListener("click",(()=>w())),document.getElementById("extendedSearch").addEventListener("click",(()=>w(15))),document.querySelector(".grid").addEventListener("mousedown",(e=>{if("BUTTON"!==e.target.tagName)return;const t=Object.values(document.querySelectorAll("div.grid > div.setResult")).indexOf(e.target.parentElement);if(!p.has(t))return;const o=p.get(t);let n=e.target.parentElement.lastElementChild.selectedIndex,i=0;for(let e of o.usedSkills){if(n<e.charm.length)break;++i,n-=e.charm.length}let r=o.usedSkills[i],a=r.charm[n];if((0,s.dj)(a),0!==n){let e=Object.fromEntries(r.charm[0]);for(let t=0;t<2;++t)if(e[a[t][0]]){let o=Math.min(e[a[t][0]],a[t][1]);e[a[t][0]]-=o,a[t][1]-=o}for(let t=0;t<2;++t){let[o,s]=a[t];if(s)for(let l of r.decos)if(!(l[0]!==o||l[1]>s))for(let o in e)if((window.thisKey.types.pointsPerSlot[l[2][8]-1][o]===l[1]||window.thisKey.types.pointsPerSlot[l[2][8]-1][o]<l[1]&&window.thisKey.types.decos[o]<=window.thisKey.types.decos[l[0]])&&e[o]>=l[1]){let n=l[1]*l[3];if(n<=e[o])l[0]=o,e[o]-=n,a[t][1]-=n;else{let n=Math.min(e[o],~~(s/l[1]));l[3]-=n,r.decos.push([o,l[1],l[2],n]),e[o]-=n,a[t][1]-=n}}}for(let t=0;t<2;++t){let[o,s]=a[t];if(!s)continue;let l=[];for(let e of Object.values(r.augments))l.push(...e.augs);for(;s-- >0;){let s=l.find((e=>e["-Skill"]===o));if(s){for(let o in e)if(e[o]>0){s["-Skill"]=o,--e[o],--a[t][1];break}}else console.log("error finding augment to replace")}}}(0,s.qy)(r.augments),(0,s.Cj)((0,s.G_)(r.decos)),document.getElementById("setReturn").classList.add("augInvis"),(0,l.TG)(),document.querySelectorAll(".extraSkills>button").forEach((e=>e.remove())),document.querySelectorAll(".grid>div").forEach((e=>e.remove())),(0,s.to)(),(0,l.TG)(),g&&console.log(JSON.parse(JSON.stringify(r))),p.clear()}))}}]);
>>>>>>> 1d32f47070dca40ba76cbe02c0c40f52d48509b7
